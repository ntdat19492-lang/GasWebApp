<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Safe Area UI Mới Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style id="dynamic-style"></style>
</head>
<body>

<h2>UI mới – Safe area dưới nút đóng</h2>
<p>Nội dung này không bị che bởi nút đóng Mini App.</p>

<div class="box">Nội dung chính</div>

<script>
    const tg = window.Telegram.WebApp;

    tg.ready();
    tg.expand();
    tg.setScreenOrientation("portrait"); // khóa dọc

    function applySafeAreaAndTheme() {
        const inset = tg.safeAreaInset;   // UI mới — quan trọng!
        const closeButtonHeight = 48;     // chiều cao nút đóng UI mới Telegram

        const topPadding = inset.top + closeButtonHeight + 12;
        const bottomPadding = inset.bottom + 16;

        const p = tg.themeParams;
        const scheme = tg.colorScheme;

        const style = document.getElementById("dynamic-style");

        style.innerHTML = `
            body {
                margin: 0;
                padding: ${topPadding}px 20px ${bottomPadding}px 20px;
                background: ${p.bg_color || (scheme === "dark" ? "#111" : "#fff")};
                color: ${p.text_color || (scheme === "dark" ? "#fff" : "#000")};
                font-family: sans-serif;
                transition: 0.2s;
            }

            .box {
                background: ${p.secondary_bg_color || (scheme === "dark" ? "#1d1d1d" : "#f0f0f0")};
                padding: 16px;
                border-radius: 10px;
            }
        `;
    }

    applySafeAreaAndTheme();
    tg.onEvent("themeChanged", applySafeAreaAndTheme);
    tg.onEvent("viewportChanged", applySafeAreaAndTheme); // UI mới cần listen viewport
</script>

</body>
</html>
